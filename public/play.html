<!DOCTYPE html>
<html>
  <head>
    <title>Partjson</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link rel="stylesheet" href="./css/normalize.css" />
    <link rel="stylesheet" href="./css/partjson.css" />
    <style>
      .jsondiv {
        height: 50vh;
      }
    </style>
    <script src="./dist/partjson.umd.js" charset="utf-8"></script>
  </head>
  <body>
    <div class="nav-top">
      <div class="nav-banner">
        <div style="float:left; padding: 0 12px;">
          <a class="nodecor" href="./">Partjson</a>
        </div>
        <div class="nav-page-wrapper">
          <a href="./" class="nav-page">Home</a>
          <a href="syntax.html" class="nav-page">Syntax</a>
          <a href="reserved.html" class="nav-page">Reserved</a>
        </div>
      </div>
      <nav class="nav-bar" onmouseleave="collapseSymbols()">
        <div style="width: 100%; min-height: 16px; white-space: nowrap;">
          <!--<div class="nav-col" id="nav-col-skip">
				<div class="nav-tab" > Syntax </div>
			</div>
			<div class="nav-col" id="nav-col-time">
				<div class="nav-tab"> Reserved </div>
			</div>-->
        </div>
      </nav>
    </div>
    <content>
      <section id="play">
        <h3 class="section-title">Play</h3>
        <!--<p>Click the <button class='try-btn' style='position:relative'>try</button> button in 
		the upper right corner of the examples below.</p>-->
        <br />
      </section>
    </content>
    <script src="./js/demo.js"></script>
    <script>
      function prep(row, context) {
        const eq = {
          knots: {},
          f1: {},
          f2: {},
          interaction: {},
          simple: {}
        }
        for (const colName in row) {
          const val = row[colName]
          if (val == "NA") continue
          if (colName.includes(".knots")) {
            const [name, knoti] = colName.split(".")
            if (!eq.knots[name]) {
              eq.knots[name] = []
            }
            eq.knots[name][+knoti.slice(5) - 1] = val
          } else if (colName.startsWith("f1(")) {
            const name = colName.slice(3, -1)
            eq.f1[name] = val
          } else if (colName.startsWith("f2(")) {
            const name = colName.slice(3, -1)
            eq.f2[name] = val
          } else if (colName.includes(".")) {
            const terms = colName.split(".")
            eq.interaction[colName] = {
              coeff: val,
              terms
            }
          } else if (colName != "CHC") {
            eq.simple[colName] = val
          }
        }
        row.eq = eq
        return true
      }

      demo(
        [
          {
            section: "play",
            id: "play",
            title: "Shape your data",
            template: {
              byChc: {
                "@before()": "=prep()",
                $CHC: {
                  //knots: "$eq.knots",
                  //f1: "$eq.f1",
                  //f2: "$eq.f2",
                  //interaction: "$eq.interaction",
                  simple: "=simple()"
                }
              }
            },
            opts: {
              "=": {
                prep,
                simple(row, context) {
                  let sum = 0
                  for (const term in row.eq.simple) {
                    sum += row.eq.simple[term] * 1 //inputs[term]
                  }
                  return sum
                },
                f1Keys(row, context) {
                  context.keyVals = {}
                  for (const colName in row) {
                    if (colName.startsWith("f1(")) {
                      keyVals[colName.slice(3, -1)] = row[colName]
                    }
                  }
                  return keys
                }
              },
              tsvText: `CHC	agedx2	steroids	abdrad2	sex	heartradboth2	doxed_sum2	white	ced_sum2	pelvisrad2	chestrad2	bleodose	brainrad2	carboplatdose	cisplatdose	hdmtdose	vcrdose	etopdose	itmtxdose	f1(age)	f2(age)	f1(cisplatdose)	f2(cisplatdose)	f1(hdmtdose)	f2(hdmtdose)	cisplatdose.abdrad2	agedx2.ced_sum2	ced_sum2.abdrad2	ced_sum2.cisplatdose	agedx2.steroids	agedx2.pelvisrad2	brainrad2.chestrad2	steroids.pelvisrad2	steroids.chestrad2	pelvisrad2.abdrad2	chestrad2.abdrad2	ced_sum2.pelvisrad2	brainrad2.doxed_sum2	brainrad2.etopdose	agedx2.abdrad2	agedx2.heartradboth2	agedx2.doxed_sum2	heartradboth2.doxed_sum2	agedx2.chestrad2	ced_sum2.chestrad2	chestrad2.bleodose	agedx2.brainrad2	brainrad2.cisplatdose	age.knots1	age.knots2	age.knots3	age.knots4	cisplatdose.knots1	cisplatdose.knots2	cisplatdose.knots3	cisplatdose.knots4	hdmtdose.knots1	hdmtdose.knots2	hdmtdose.knots3	hdmtdose.knots4
1	-0.012509172	0.313241515	0.051665453	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
3	-0.139708515	NA	NA	-0.31143334	0.375607677	0.194551156	0.292615275	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.363818617	-0.701845372	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	-0.002334631	0.008265766	-0.008620797	NA	NA	NA	NA	NA	0.059137577	4.512525667	10.94099932	17.72758385	NA	NA	NA	NA	NA	NA	NA	NA
4	-0.04821215	NA	NA	0.208023467	0.393769989	0.396593449	-0.309814114	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.000874321	0.042878492	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.003474723	-0.043826146	NA	NA	NA	NA	NA	0.087611225	4.5137577	10.91156742	17.770705	NA	NA	NA	NA	NA	NA	NA	NA
6	-0.010902945	NA	0.021767095	NA	NA	NA	NA	0.070495982	0.04091997	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
7	-0.097317193	NA	-0.59939771	NA	NA	NA	NA	0.719843581	0.708331317	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
8	0.002672345	NA	-0.023340036	-1.134767592	NA	NA	0.384042908	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
9	-0.009610699	NA	NA	NA	NA	NA	0.792124138	NA	NA	0.329568133	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
10	-0.038788684	NA	NA	NA	NA	NA	-0.386743786	0.043548697	NA	0.745092916	0.007969908	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	-0.021048569	-0.022202493	-0.001819528	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
11	0.094799179	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.176944209	0.000186088	0.010015791	NA	NA	NA	NA	NA	NA	-0.054636402	0.061844015	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.016951591	-0.000359161	NA	NA	NA	NA	42.85714286	120.1298701	390.4761905	812.1084223	NA	NA	NA	NA
12	0.37452305	NA	NA	0.225750718	NA	NA	0.243517531	NA	NA	NA	NA	NA	NA	NA	-1.28E-05	NA	NA	NA	-1.483480227	2.912342476	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.087063655	4.403011636	10.55386721	17.66297057	NA	NA	NA	NA	NA	NA	NA	NA
13	-0.071501433	0.059229702	NA	NA	NA	NA	NA	0.142571917	NA	NA	NA	0.151111703	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
15	-0.002841649	NA	0.217049012	NA	NA	NA	NA	NA	-0.162401132	-0.010664807	NA	0.181887189	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
16	-0.012531704	NA	-0.002162915	NA	NA	NA	NA	0.055739985	NA	0.004342413	NA	NA	5.81E-05	0.000540188	2.65E-06	NA	NA	NA	NA	NA	NA	NA	0.000840938	-0.001120158	-1.86E-05	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	799.086758	3949.615385	15852.30769	108004.3478
17	-0.046902672	0.026217497	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.000246803	0.001433973	NA	-0.002664024	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
18	-0.009243695	NA	-0.10675995	-1.6727871	NA	NA	-0.68536165	0.484189426	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	-0.05692797	0.168218422	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
19	-0.031057222	NA	0.317486796	NA	NA	NA	NA	0.071387194	NA	NA	NA	NA	0.000123808	0.003238244	7.13E-06	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	-0.000423066	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
21	-0.06096826	NA	NA	0.367626817	NA	NA	0.478581576	NA	0.143570101	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
22	0.075322533	1.268467047	0.36917502	-0.375528347	NA	NA	NA	NA	0.465801948	-0.108311851	NA	-0.394419981	NA	NA	NA	NA	NA	NA	0.589397512	-1.278212747	NA	NA	NA	NA	NA	NA	NA	NA	0.033377917	-0.012821762	0.154182876	0.213430366	-0.678191575	-0.26717888	-0.086309121	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.022236395	NA	0.102121834	4.605065024	11.01957563	17.7303217	NA	NA	NA	NA	NA	NA	NA	NA
24	-0.133458346	NA	NA	0.698772656	0.80864175	0.195107205	-0.074833999	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.322726841	-0.544068263	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	-0.024823698	NA	-0.069130656	NA	NA	NA	NA	NA	0.076659822	4.452429843	10.88021903	17.73305955	NA	NA	NA	NA	NA	NA	NA	NA
25	-0.011831434	NA	NA	NA	NA	NA	-0.130152828	NA	NA	NA	NA	0.104168468	NA	NA	NA	NA	NA	NA	-0.983631315	1.126373007	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	-0.006884577	NA	0.008213552	4.219986311	10.44024641	17.62587269	NA	NA	NA	NA	NA	NA	NA	NA
27	-0.010612041	NA	0.159183482	-0.322182578	NA	0.060673159	0.242023964	0.138292056	0.044217715	0.241592627	NA	0.212045501	NA	NA	NA	NA	-2.71E-05	NA	NA	NA	NA	NA	NA	NA	NA	NA	-0.046288404	NA	NA	NA	-0.047656266	NA	NA	NA	NA	-0.004928897	0.039256135	1.91E-05	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
28	0.020844455	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.253627942	NA	NA	NA	NA	NA	0.001700254	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
29	0.038913111	NA	NA	-1.191610247	NA	NA	NA	NA	NA	NA	NA	-0.021068897	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
30	0.064437697	NA	0.439794102	0.129535214	NA	NA	0.297726379	NA	NA	0.186761237	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	-0.026379873	NA	NA	NA	-0.008725358	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
31	-0.017992776	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	0.294869944	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA
32	0.001059302	NA	NA	0.124438781	0.902849416	0.22332377	0.259201572	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	-0.097833604	0.299951579	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	-0.020163527	NA	-0.021906215	NA	NA	NA	NA	NA	0.06844627	4.509240246	10.88021903	17.75824778	NA	NA	NA	NA	NA	NA	NA	NA`
            }
          }
        ],
        true
      )
    </script>
  </body>
</html>
